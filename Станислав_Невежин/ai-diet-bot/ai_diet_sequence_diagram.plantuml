@startuml
title Sequence Diagram: –°–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –ø–ª–∞–Ω–∞ –ø–∏—Ç–∞–Ω–∏—è AI –¥–∏–µ—Ç–æ–ª–æ–≥–æ–º 3.0 (Telegram Bot)

autonumber

actor "–°–ø–æ—Ä—Ç—Å–º–µ–Ω" as User
participant "Telegram Bot" as Bot
participant "Telegram Server" as Telegram
participant "Backend\n(AI Agent)" as Backend
participant "LLM\n(DeepSeek)" as LLM
database "PostgreSQL\nDatabase" as DB

== –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é ==

User -> Bot: –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞ /start
Bot -> Telegram: –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–º–∞–Ω–¥—ã start
Telegram -> Backend: Webhook: /start
Backend -> DB: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n(—Ç–∞–±–ª–∏—Ü—ã: athletes (telegram_id, athlete_id), workouts, activities, meal_plans)
DB --> Backend: –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ —Ç–∞–±–ª–∏—Ü athletes, workouts, activities, meal_plans
Backend --> Telegram: –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é —Å inline-–∫–Ω–æ–ø–∫–∞–º–∏
Telegram --> Bot: –°–æ–æ–±—â–µ–Ω–∏–µ —Å –º–µ–Ω—é
Bot --> User: "–ü—Ä–∏–≤–µ—Ç! –Ø AI –¥–∏–µ—Ç–æ–ª–æ–≥ 3.0 –∏ –ø–æ–º–æ–≥—É —Ç–µ–±–µ —Å–æ—Å—Ç–∞–≤–∏—Ç—å –ø–ª–∞–Ω –ø–∏—Ç–∞–Ω–∏—è –¥–ª—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –∫ —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è–º! –í—ã–±–µ—Ä–∏ –¥–µ–π—Å—Ç–≤–∏–µ:"\n[–°–æ—Å—Ç–∞–≤–∏—Ç—å –ø–ª–∞–Ω] [–°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –ø–ª–∞–Ω—ã]

== –°–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–ª–∞–Ω–∞ - –≤–≤–æ–¥ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ ==

User -> Bot: –ù–∞–∂–∞—Ç–∏–µ "–°–æ—Å—Ç–∞–≤–∏—Ç—å –ø–ª–∞–Ω"
Bot -> Telegram: Callback: create_plan
Telegram -> Backend: Webhook: /create_plan

loop –î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞
    Backend --> Telegram: –ó–∞–ø—Ä–æ—Å –æ–¥–Ω–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞
    Telegram --> Bot: –°–æ–æ–±—â–µ–Ω–∏–µ —Å –≤–æ–ø—Ä–æ—Å–æ–º
    Bot --> User: –í–æ–ø—Ä–æ—Å –ø–æ –ø–∞—Ä–∞–º–µ—Ç—Ä—É (–∏–º—è, –¥–∞—Ç–∞, –ø–æ–ª, —Ä–æ—Å—Ç, —Ç–µ–∫—É—â–∏–π –≤–µ—Å, —Ü–µ–ª–µ–≤–æ–π –≤–µ—Å)
    User -> Bot: –û—Ç–≤–µ—Ç –ø–æ –ø–∞—Ä–∞–º–µ—Ç—Ä—É
    Bot -> Telegram: –û—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç–≤–µ—Ç–∞
    Telegram -> Backend: Webhook —Å –æ—Ç–≤–µ—Ç–æ–º
end

Backend -> Backend: –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

alt –ù–µ –≤—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤–≤–µ–¥–µ–Ω—ã
    Backend --> Telegram: –ó–∞–ø—Ä–æ—Å –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
    Telegram --> Bot: –°–æ–æ–±—â–µ–Ω–∏–µ —Å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ–º
    Bot --> User: "‚ö†Ô∏è –í–≤–µ–¥–µ–Ω—ã –Ω–µ –≤—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã!\n–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ"
else –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–µ–≤–∞–ª–∏–¥–Ω—ã (–Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Ñ–æ—Ä–º–∞—Ç—É)
    Backend --> Telegram: –ó–∞–ø—Ä–æ—Å –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤–≤–æ–¥–∞
    Telegram --> Bot: –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ —Ñ–æ—Ä–º–∞—Ç–∞
    Bot --> User: "‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏ –¥–∞–Ω–Ω—ã–µ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ"
else –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–∞—Ä—É—à–∞—é—Ç –ª–æ–≥–∏–∫—É (–¥–∞—Ç–∞ –≤ –ø—Ä–æ—à–ª–æ–º, < –Ω–µ–¥–µ–ª–∏ –¥–æ —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏–π, —Ä–∞–∑–Ω–∏—Ü–∞ –≤–µ—Å–æ–≤ > 5%)
    Backend --> Telegram: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ —Å –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ–º
    Telegram --> Bot: –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ —Å –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ–º
    Bot --> User: "‚ùå –û—à–∏–±–∫–∞: –î–∞–Ω–Ω—ã–µ –Ω–∞—Ä—É—à–∞—é—Ç –ª–æ–≥–∏–∫—É. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ–≤–µ—Ä—å –≤–≤–µ–¥–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è"
    Backend -> Backend: –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏
else –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –≤–∞–ª–∏–¥–Ω—ã –∏ –ø–æ–ª–Ω—ã–µ
    Backend -> DB: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Å–ø–æ—Ä—Ç—Å–º–µ–Ω–∞ (—Ç–∞–±–ª–∏—Ü–∞ athletes)
    DB --> Backend: –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
    Backend --> Telegram: –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∏ –ø–µ—Ä–µ—Ö–æ–¥ –∫ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞–º
    Telegram --> Bot: –°–æ–æ–±—â–µ–Ω–∏–µ –æ –Ω–∞—á–∞–ª–µ –∏–Ω—Ç–µ—Ä–≤—å—é –ø–æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞–º
    Bot --> User: "‚úÖ –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã! –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ –≤–æ–ø—Ä–æ—Å–∞–º –æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞–º üèãÔ∏è‚Äç‚ôÇÔ∏è"
end

== –≠—Ç–∞–ø –∏–Ω—Ç–µ—Ä–≤—å—é: –†–µ–∂–∏–º —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ ==

loop –î–ª—è –∫–∞–∂–¥–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞ –æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞—Ö
    Backend --> Telegram: –í–æ–ø—Ä–æ—Å –æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞—Ö
    Telegram --> Bot: –°–æ–æ–±—â–µ–Ω–∏–µ —Å –≤–æ–ø—Ä–æ—Å–æ–º
    Bot --> User: –í–æ–ø—Ä–æ—Å (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫, —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è, –≤–µ—Å —Å–Ω–∞—Ä—è–¥–æ–≤, –ø–æ–≤—Ç–æ—Ä—ã, –ø–æ–¥—Ö–æ–¥—ã)
    User -> Bot: –û—Ç–≤–µ—Ç –æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞–º
    Bot -> Telegram: –û—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç–≤–µ—Ç–∞
    Telegram -> Backend: Webhook —Å –æ—Ç–≤–µ—Ç–æ–º
end

Backend -> Backend: –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫

alt –ù–µ –≤—Å–µ –æ—Ç–≤–µ—Ç—ã –≤–≤–µ–¥–µ–Ω—ã
    Backend --> Telegram: –ó–∞–ø—Ä–æ—Å –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
    Telegram --> Bot: –°–æ–æ–±—â–µ–Ω–∏–µ —Å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ–º
    Bot --> User: "‚ö†Ô∏è –í–≤–µ–¥–µ–Ω—ã –Ω–µ –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞—Ö!"
else –î–∞–Ω–Ω—ã–µ –Ω–µ–≤–∞–ª–∏–¥–Ω—ã (–Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Ñ–æ—Ä–º–∞—Ç—É)
    Backend --> Telegram: –ó–∞–ø—Ä–æ—Å –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤–≤–æ–¥–∞
    Telegram --> Bot: –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ —Ñ–æ—Ä–º–∞—Ç–∞
    Bot --> User: "‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞—Ö"
else –î–∞–Ω–Ω—ã–µ –Ω–∞—Ä—É—à–∞—é—Ç –ª–æ–≥–∏–∫—É (—Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ <1 –∏–ª–∏ >14 –≤ –Ω–µ–¥–µ–ª—é, –≤–µ—Å/–ø–æ–≤—Ç–æ—Ä—ã/–ø–æ–¥—Ö–æ–¥—ã <0)
    Backend --> Telegram: –ó–∞–ø—Ä–æ—Å –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤–≤–æ–¥–∞
    Telegram --> Bot: –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ –ª–æ–≥–∏–∫–∏
    Bot --> User: "‚ùå –î–∞–Ω–Ω—ã–µ –æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞—Ö –Ω–∞—Ä—É—à–∞—é—Ç –ª–æ–≥–∏–∫—É. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ–≤–µ—Ä—å –∑–Ω–∞—á–µ–Ω–∏—è"
else –î–∞–Ω–Ω—ã–µ –≤–∞–ª–∏–¥–Ω—ã
    Backend -> DB: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞—Ö (—Ç–∞–±–ª–∏—Ü–∞ workouts)
    DB --> Backend: –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
    Backend --> Telegram: –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∏ –ø–µ—Ä–µ—Ö–æ–¥ –∫ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
    Telegram --> Bot: –°–æ–æ–±—â–µ–Ω–∏–µ –æ –Ω–∞—á–∞–ª–µ –∏–Ω—Ç–µ—Ä–≤—å—é –ø–æ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
    Bot --> User: "‚úÖ –î–∞–Ω–Ω—ã–µ –æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞—Ö —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã! –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ –≤–æ–ø—Ä–æ—Å–∞–º –æ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ üö∂‚Äç‚ôÇÔ∏è"
end

== –≠—Ç–∞–ø –∏–Ω—Ç–µ—Ä–≤—å—é: –§–∏–∑–∏—á–µ—Å–∫–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å ==

loop –î–ª—è –∫–∞–∂–¥–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞ –æ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
    Backend --> Telegram: –í–æ–ø—Ä–æ—Å –æ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
    Telegram --> Bot: –°–æ–æ–±—â–µ–Ω–∏–µ —Å –≤–æ–ø—Ä–æ—Å–æ–º
    Bot --> User: –í–æ–ø—Ä–æ—Å (—à–∞–≥–∏ –≤ –¥–µ–Ω—å, —Ö–∞—Ä–∞–∫—Ç–µ—Ä —Ä–∞–±–æ—Ç—ã, –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å, —á–∞—Å—ã –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏)
    User -> Bot: –û—Ç–≤–µ—Ç –æ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
    Bot -> Telegram: –û—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç–≤–µ—Ç–∞
    Telegram -> Backend: Webhook —Å –æ—Ç–≤–µ—Ç–æ–º
end

Backend -> Backend: –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

alt –ù–µ –≤—Å–µ –æ—Ç–≤–µ—Ç—ã –≤–≤–µ–¥–µ–Ω—ã
    Backend --> Telegram: –ó–∞–ø—Ä–æ—Å –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
    Telegram --> Bot: –°–æ–æ–±—â–µ–Ω–∏–µ —Å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ–º
    Bot --> User: "‚ö†Ô∏è –í–≤–µ–¥–µ–Ω—ã –Ω–µ –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –æ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏!"
else –î–∞–Ω–Ω—ã–µ –Ω–µ–≤–∞–ª–∏–¥–Ω—ã (–Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Ñ–æ—Ä–º–∞—Ç—É)
    Backend --> Telegram: –ó–∞–ø—Ä–æ—Å –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤–≤–æ–¥–∞
    Telegram --> Bot: –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ —Ñ–æ—Ä–º–∞—Ç–∞
    Bot --> User: "‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö –æ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏"
else –î–∞–Ω–Ω—ã–µ –Ω–∞—Ä—É—à–∞—é—Ç –ª–æ–≥–∏–∫—É (–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å <0 —á–∞—Å–æ–≤)
    Backend --> Telegram: –ó–∞–ø—Ä–æ—Å –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤–≤–æ–¥–∞
    Telegram --> Bot: –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ –ª–æ–≥–∏–∫–∏
    Bot --> User: "‚ùå –î–∞–Ω–Ω—ã–µ –æ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –Ω–∞—Ä—É—à–∞—é—Ç –ª–æ–≥–∏–∫—É. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ–≤–µ—Ä—å –∑–Ω–∞—á–µ–Ω–∏—è"
else –î–∞–Ω–Ω—ã–µ –≤–∞–ª–∏–¥–Ω—ã
    Backend -> DB: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (—Ç–∞–±–ª–∏—Ü–∞ activities)
    DB --> Backend: –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
    Backend --> Telegram: –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∏ –Ω–∞—á–∞–ª–æ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–ª–∞–Ω–∞
    Telegram --> Bot: –°–æ–æ–±—â–µ–Ω–∏–µ –æ –Ω–∞—á–∞–ª–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
    Bot --> User: "‚úÖ –í—Å–µ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã! –ù–∞—á–∏–Ω–∞–µ–º –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –ø–ª–∞–Ω–∞ –ø–∏—Ç–∞–Ω–∏—è üçΩÔ∏è"
end

== –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–ª–∞–Ω–∞ –ø–∏—Ç–∞–Ω–∏—è ==

Backend -> DB: –ê–≥—Ä–µ–≥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n(—Ç–∞–±–ª–∏—Ü—ã: athletes, workouts, activities)
DB --> Backend: –í—Å–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
Backend -> LLM: HTTPS: –ó–∞–ø—Ä–æ—Å –Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –ø–ª–∞–Ω–∞ –ø–∏—Ç–∞–Ω–∏—è –Ω–∞ –¥–µ–Ω—å\n(—Å–æ–¥–µ—Ä–∂–∏—Ç –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)
LLM --> Backend: –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–ª–∞–Ω –Ω–∞ –¥–µ–Ω—å\n(–∫–∞–ª–æ—Ä–∏–∏, –±–µ–ª–∫–∏, –∂–∏—Ä—ã, —É–≥–ª–µ–≤–æ–¥—ã, –ø—Ä–∏–µ–º—ã –ø–∏—â–∏)
Backend -> DB: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–ª–∞–Ω–∞ –ø–∏—Ç–∞–Ω–∏—è (—Ç–∞–±–ª–∏—Ü–∞ meal_plans)
DB --> Backend: –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è

== –û—Ç–ø—Ä–∞–≤–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é ==

Backend --> Telegram: –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—à–Ω–æ–º —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–ª–∞–Ω–∞
Telegram --> Bot: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏
Bot --> User: "üéâ –ü–ª–∞–Ω –ø–∏—Ç–∞–Ω–∏—è –≥–æ—Ç–æ–≤! –í—ã–±–µ—Ä–∏ –¥–µ–π—Å—Ç–≤–∏–µ:"\n[–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø–ª–∞–Ω] [–í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é]"

User -> Bot: –ù–∞–∂–∞—Ç–∏–µ "–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø–ª–∞–Ω"
Bot -> Telegram: Callback: view_plan
Telegram -> Backend: Webhook: /view_plan
Backend -> DB: –ó–∞–ø—Ä–æ—Å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–ª–∞–Ω–∞ (—Ç–∞–±–ª–∏—Ü–∞ meal_plans)
DB --> Backend: –î–∞–Ω–Ω—ã–µ –ø–ª–∞–Ω–∞ –Ω–∞ –¥–µ–Ω—å
Backend --> Telegram: –î–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω –ø–∏—Ç–∞–Ω–∏—è –Ω–∞ –¥–µ–Ω—å
Telegram --> Bot: –°–æ–æ–±—â–µ–Ω–∏–µ —Å –ø–ª–∞–Ω–æ–º
Bot --> User: "üìã –¢–≤–æ–π –ø–ª–∞–Ω –ø–∏—Ç–∞–Ω–∏—è –Ω–∞ –¥–µ–Ω—å:\n‚Ä¢ –î–∞—Ç–∞: –î–î.–ú–ú.–ì–ì–ì–ì\n‚Ä¢ –ö–∞–ª–æ—Ä–∏–∏: 2300\n‚Ä¢ –ë–µ–ª–∫–∏: 201.2–≥\n‚Ä¢ –ñ–∏—Ä—ã: 63.9–≥\n‚Ä¢ –£–≥–ª–µ–≤–æ–¥—ã: 230.2–≥\n‚Ä¢ –ó–∞–≤—Ç—Ä–∞–∫: –û–≤—Å—è–Ω–∫–∞ —Å —è–≥–æ–¥–∞–º–∏ (50–≥), –æ–º–ª–µ—Ç –∏–∑ 2 —è–∏—Ü\n‚Ä¢ –û–±–µ–¥: –ì—Ä–µ—á–∫–∞ (80–≥) —Å –∫—É—Ä–∏–Ω–æ–π –≥—Ä—É–¥–∫–æ–π (150–≥), –æ–≤–æ—â–Ω–æ–π —Å–∞–ª–∞—Ç\n‚Ä¢ –£–∂–∏–Ω: –¢–≤–æ—Ä–æ–≥ 5% (200–≥) —Å –æ—Ä–µ—Ö–∞–º–∏ (30–≥), –∫–µ—Ñ–∏—Ä 1% (200–º–ª)"

alt –û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–ª–∞–Ω–∞
    Backend --> Telegram: –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
    Telegram --> Bot: –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
    Bot --> User: "‚ùå –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –ø–ª–∞–Ω–∞ –ø–∏—Ç–∞–Ω–∏—è. –ü–æ–ø—Ä–æ–±—É–π –ø–æ–∑–∂–µ –∏–ª–∏ –æ–±—Ä–∞—Ç–∏—Å—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É."
end

Backend --> Telegram: –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
Telegram --> Bot: –°–æ–æ–±—â–µ–Ω–∏–µ —Å –º–µ–Ω—é
Bot --> User: "–ü—Ä–∏–≤–µ—Ç! –Ø AI –¥–∏–µ—Ç–æ–ª–æ–≥ 3.0 –∏ –ø–æ–º–æ–≥—É —Ç–µ–±–µ —Å–æ—Å—Ç–∞–≤–∏—Ç—å –ø–ª–∞–Ω –ø–∏—Ç–∞–Ω–∏—è –¥–ª—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –∫ —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è–º! –í—ã–±–µ—Ä–∏ –¥–µ–π—Å—Ç–≤–∏–µ:"\n[–°–æ—Å—Ç–∞–≤–∏—Ç—å –ø–ª–∞–Ω] [–°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –ø–ª–∞–Ω—ã]

== –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –ø–ª–∞–Ω–æ–≤ ==

User -> Bot: –ù–∞–∂–∞—Ç–∏–µ "–°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –ø–ª–∞–Ω—ã"
Bot -> Telegram: Callback: saved_plans
Telegram -> Backend: Webhook: /saved_plans
Backend -> DB: –ó–∞–ø—Ä–æ—Å —Å–ø–∏—Å–∫–∞ –ø–ª–∞–Ω–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Ç–∞–±–ª–∏—Ü–∞ meal_plans)
DB --> Backend: –°–ø–∏—Å–æ–∫ –ø–ª–∞–Ω–æ–≤ —Å –¥–∞—Ç–∞–º–∏

alt –°–ø–∏—Å–æ–∫ –ø—É—Å—Ç–æ–π
    Backend --> Telegram: –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –ø–ª–∞–Ω–æ–≤
    Telegram --> Bot: –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    Bot --> User: "üì≠ –£ —Ç–µ–±—è –ø–æ–∫–∞ –Ω–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –ø–ª–∞–Ω–æ–≤ –ø–∏—Ç–∞–Ω–∏—è. –°–æ–∑–¥–∞–π –ø–µ—Ä–≤—ã–π –ø–ª–∞–Ω!"
else –°–ø–∏—Å–æ–∫ –Ω–µ –ø—É—Å—Ç–æ–π
    Backend --> Telegram: –°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ø–ª–∞–Ω–æ–≤ —Å –∫–Ω–æ–ø–∫–∞–º–∏
    Telegram --> Bot: –°–æ–æ–±—â–µ–Ω–∏–µ —Å –≤—ã–±–æ—Ä–æ–º –ø–ª–∞–Ω–∞
    Bot --> User: "üìÖ –¢–≤–æ–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –ø–ª–∞–Ω—ã –ø–∏—Ç–∞–Ω–∏—è:\n[–ü–ª–∞–Ω –æ—Ç –î–î.–ú–ú.–ì–ì–ì–ì]\n[–ü–ª–∞–Ω –æ—Ç –î–î.–ú–ú.–ì–ì–ì–ì]"
end

User -> Bot: –í—ã–±–æ—Ä –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–ª–∞–Ω–∞
Bot -> Telegram: Callback: view_saved_plan
Telegram -> Backend: Webhook: /view_saved_plan?date=–î–î.–ú–ú.–ì–ì–ì–ì
Backend -> DB: –ó–∞–ø—Ä–æ—Å –¥–∞–Ω–Ω—ã—Ö –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –ø–ª–∞–Ω–∞ (—Ç–∞–±–ª–∏—Ü–∞ meal_plans)
DB --> Backend: –î–∞–Ω–Ω—ã–µ –ø–ª–∞–Ω–∞ –Ω–∞ –¥–µ–Ω—å
Backend --> Telegram: –î–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω –ø–∏—Ç–∞–Ω–∏—è
Telegram --> Bot: –°–æ–æ–±—â–µ–Ω–∏–µ —Å –ø–ª–∞–Ω–æ–º
Bot --> User: "üìã –¢–≤–æ–π –ø–ª–∞–Ω –ø–∏—Ç–∞–Ω–∏—è –Ω–∞ –î–î.–ú–ú.–ì–ì–ì–ì:\n‚Ä¢ –ö–∞–ª–æ—Ä–∏–∏: 2300\n‚Ä¢ –ë–µ–ª–∫–∏: 201.2–≥\n‚Ä¢ –ñ–∏—Ä—ã: 63.9–≥\n‚Ä¢ –£–≥–ª–µ–≤–æ–¥—ã: 230.2–≥\n‚Ä¢ –ó–∞–≤—Ç—Ä–∞–∫: ...\n‚Ä¢ –û–±–µ–¥: ...\n‚Ä¢ –£–∂–∏–Ω: ..."

Backend --> Telegram: –ö–Ω–æ–ø–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
Telegram --> Bot: –°–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–Ω–æ–ø–∫–æ–π
Bot --> User: "–ó–∞–≤–µ—Ä—à–∏—Ç—å –ø—Ä–æ—Å–º–æ—Ç—Ä –ø–ª–∞–Ω–∞" —Å –∫–Ω–æ–ø–∫–æ–π [–ó–∞–≤–µ—Ä—à–∏—Ç—å]

== –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏ ==

User -> Bot: –ù–∞–∂–∞—Ç–∏–µ "–ó–∞–≤–µ—Ä—à–∏—Ç—å –ø—Ä–æ—Å–º–æ—Ç—Ä –ø–ª–∞–Ω–∞"
Bot -> Telegram: Callback: finish_session
Telegram -> Backend: Webhook: /finish_session
Backend -> Backend: –û—á–∏—Å—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö —Å–µ—Å—Å–∏–∏
Backend --> Telegram: –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏
Telegram --> Bot: –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
Bot --> User: "üèÅ –°–µ—Å—Å–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞. –£–¥–∞—á–∏ –Ω–∞ —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è—Ö! üèÜ"

@enduml