# REST API

## Endpoint: POST /v1/personality/determine
**Описание:** Определяет соционический тип личности на основе ответов пользователя. Взаимодействует с LLM (Gemini) и сохраняет результат в Google Sheets

### Request
| Название параметра | Расположение | Тип данных | Описание | Обязательность |
|-------------------|--------------|------------|----------|----------------|
| Authorization     | Headers      | string     | API ключ в формате "Bearer {API_KEY}" | Да |
| user_id           | Body         | integer    | ID пользователя в системе (из таблицы User) | Да |
| telegram_username | Body         | string     | Никнейм пользователя в Telegram (@username) | Да |
| answers           | Body         | JSON       | Массив ответов пользователя в формате `[{"question_id": 1, "answer": "Текст ответа"}, ...]` | Да |

### Response
- **200 OK**: Тип успешно определен и сохранен
- **400 Bad Request**: Неверный формат данных (например, ответы отсутствуют или не в JSON)
- **500 Internal Server Error**: Ошибка при взаимодействии с Gemini API, Google Sheets или базой данных

---

## Endpoint: POST /v1/group/analyze
**Описание:** Запускает анализ групповой динамики для указанного чата. Анализирует историю сообщений через Telegram API, типы личности из Google Sheets и генерирует отчет с помощью LLM (Gemini)

### Request
| Название параметра | Расположение | Тип данных | Описание | Обязательность |
|-------------------|--------------|------------|----------|----------------|
| Authorization     | Headers      | string     | API ключ в формате "Bearer {API_KEY}" | Да |
| chat_id           | Body         | integer    | ID чата в системе (из таблицы Chat) | Да |
| period_days       | Body         | integer    | Количество дней для анализа | Нет |

### Response
- **200 OK**: Анализ завершен, отчет сгенерирован и сохранен
- **403 Forbidden**: Недостаточно данных для анализа (<70% участников прошли тест)
- **500 Internal Server Error**: Ошибка при взаимодействии с Telegram API, Gemini, Google Sheets или базой данных

---

## Endpoint: GET /v1/group/report/{report_id}
**Описание:** Возвращает сгенерированный отчет по группе в формате, готовом для отправки в Telegram-бота

### Request
| Название параметра | Расположение | Тип данных | Описание | Обязательность |
|-------------------|--------------|------------|----------|----------------|
| Authorization     | Headers      | string     | API ключ в формате "Bearer {API_KEY}" | Да |
| report_id         | Path         | integer    | ID отчета (из таблицы GroupReport) | Да |

### Response
- **200 OK**: Успешный запрос
- **404 Not Found**: Отчет с указанным ID не найден
- **500 Internal Server Error**: Внутренняя ошибка сервера

---

## Endpoint: POST /v1/chat/sync
**Описание:** Синхронизирует данные участников чата с Telegram. Обновляет информацию в таблице ChatMember. Используется при добавлении бота в чат; обнаружении изменения состава участников; перед генерацией отчета `/report`

### Request
| Название параметра | Расположение | Тип данных | Описание | Обязательность |
|-------------------|--------------|------------|----------|----------------|
| Authorization     | Headers      | string     | API ключ в формате "Bearer {API_KEY}" | Да |
| chat_id           | Body         | integer    | ID чата в системе (из таблицы Chat) | Да |

### Response
- **200 OK**: Синхронизация завершена
- **500 Internal Server Error**: Ошибка при взаимодействии с Telegram API или базой данных.
