# Use Case: AI-Индексатор артефактов

## Заголовок
Аналитик присваивает артефактам метки и фильтрует их по этим меткам, чтобы быстро группировать и просматривать нужные элементы в контексте проекта.

## Акторы  
Аналитик (основной автор)  
AI-Индексатор (ML-модуль)  
Хранилище артефактов (БД)

## Предусловия  
- Аналитик уже существует в системе и имеет доступ к артефактам.  
- В проекте загружены артефакты (текстовые записи, метаданные).  
- AI-Индексатор обучен на исторических данных проекта и подключён к хранилищу.

## Постусловия  
- Аналитику присвоены актуальные метки по каждому выбранному артефакту.  
- Метки сохранены в БД и отправлены в очередь дообучения модели.  
- Фильтрация по выбранным меткам возвращает корректный набор артефактов.

## Ограничения  
- Максимум меток на артефакт задаётся настройкой проекта (по умолчанию 10).  
- Одновременная фильтрация по меткам — не более 5.  
- Массовое присвоение меток происходит в фоне при выборе > N артефактов (N настраивается).

## Триггер  
Аналитик выбирает команду «Присвоить метки» или «Фильтровать по меткам» в интерфейсе;  
или запускает «Массовое присвоение меток».

## Основной сценарий  
1. Аналитик выбирает один или несколько артефактов в списке.  
2. Нажимает «Присвоить метки».  
3. Система отправляет запрос к AI-Индексатору:
```
POST /label
{
"artifact_ids": [...],
"user_id": "...",
"max_labels": projectConfig.maxLabelsPerArtifact
}
```
4. AI-Индексатор возвращает до k рекомендаций меток (k настраивается, по умолчанию 5) с полем confidence и пояснением.  
5. Интерфейс позволяет аналитикам принять или отклонить каждую метку, добавить свои.  
6. Принятые метки сохраняются в БД и отправляются в очередь обучения ML-модели.  
7. Аналитик выбирает «Фильтровать по меткам», отмечает до projectConfig.maxFilterTags и применяет фильтрацию.  
8. Система мгновенно возвращает артефакты, соответствующие выбранным меткам (до 1 с для 10 000 артефактов).

## Альтернативные сценарии  
1. Низкая уверенность модели  
- Если рекомендовано < projectConfig.minRecommendedLabels (обычно 2) при confidence ниже порога → предложить ввод меток вручную.  
2. Превышен лимит меток  
- Аналитик пытается добавить больше, чем projectConfig.maxLabelsPerArtifact → вывести предупреждение и предложить удалить старые метки.  
3. Пустой результат фильтрации  
- Ничего не найдено → предложить снять часть меток или расширить выбор дочерними/синонимными метками.  
4. Массовое присвоение меток  
- При выборе ≥ N артефактов (настраивается) — запустить фоновую задачу, результат придёт уведомлением, метки сохранятся и отобразятся в разделе «Массовая разметка».

## Исключительные сценарии  
1. Ошибка БД  
- «Не удалось сохранить метки. Повторите позже.»  
2. Сбой AI-Индексатора  
- «Сервис рекомендаций временно недоступен. Введите метки вручную.»  
3. Тайм-аут запроса  
- По истечении projectConfig.timeout (по умолчанию 5 с): «Сервис не отвечает. Метки можно добавить вручную.»

## Критерии успеха  
- Precision и recall рекомендаций меток ≥ 80 %.  
- Среднее время ответа AI-Индексатора ≤ 2 с.  
- Доля принятия рекомендаций аналитиками ≥ 60 %.  
- Фильтрация (до 10 000 артефактов) возвращает результат ≤ 1 с.  
- Регулярное дообучение модели на фидбэке аналитиков предотвращает drift.
