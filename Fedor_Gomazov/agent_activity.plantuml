@startuml
skinparam defaultFontName "Segoe UI"
skinparam defaultFontSize 10
skinparam backgroundColor #FFFFFF

title Фиксация нарушения безопасности через Telegram-бота (US-001)

|Специалист по охране труда|
start
:Отправляет команду /report в боте;

|Telegram-бот|
:Получает команду /report;
:Запрашивает описание нарушения;

|Специалист по охране труда|
:Отправляет описание нарушения;

|Telegram-бот|
:Передает описание в LLM для анализа;

|LLM|
:Анализирует текст;
:Определяет тип нарушения;

|Telegram-бот|
if (Тип определен?) then (да)
  :Запрашивает подтверждение классификации;
else (нет)
  :Запрашивает уточняющую информацию;
  repeat
    :Получает дополнительные детали;
    :Повторно анализирует ввод;
  repeat while (Тип определен?) is (нет) 
  ->да;
  :Записывает как "Неопределенное нарушение";
endif

|Специалист по охране труда|
:Подтверждает/корректирует тип;

|Telegram-бот|
if (Нужны доп. детали?) then (да)
  :Запрашивает дополнительные детали;
  |Специалист по охране труда|
  :Предоставляет доп. детали;
  |Telegram-бот|
endif
:Запрашивает фото/видео подтверждение;

|Специалист по охране труда|
if (Есть медиафайл?) then (да)
  :Отправляет медиафайл;
  |Telegram-бот|
  :Получает медиафайл;
else (нет)
  |Telegram-бот|
  :Отмечает как "без визуального подтверждения";
endif

|Telegram-бот|
:Определяет геолокацию и время;
if (Геолокация доступна?) then (нет)
  :Запрашивает ручной ввод местоположения;
  |Специалист по охране труда|
  :Указывает место текстом;
  |Telegram-бот|
endif

|Система формирования предписаний|
:Сохраняет полный отчет;
:Формирует предписание с рекомендациями;

|Уведомительная система|
:Отправляет уведомление ответственному лицу;

|Telegram-бот|
:Подтверждает успешную фиксацию;

|Специалист по охране труда|
end

@enduml